## finnegan/cds-api

[![License](http://img.shields.io/badge/license-MIT-brightgreen.svg?style=flat-square)](https://tldrlegal.com/license/mit-license)

FinneganCDS is a web Content Design System built on top of [Laravel framework](http://laravel.com).

## Installation

Add the repository to your composer.json:
```json
{
    "repositories":
    [
        {
            "type":"vcs",
            "url":"git@gitlab.test5.hce.it:finnegan/extensions/cds-api.git"
        }
    ]
}
```

Install the package:
```bash
composer require finnegan/cds-api
```

Publish configuration and assets
```bash
php artisan vendor:publish --provider=Finnegan\\Api\\ApiServiceProvider
```

## Basic usage

### Configuration
The main configuration is located in the `config/finnegan-api.php` file. Here you can set some general metadata for
your API specification such as the title, the description, etc.

Make sure that the `prefix` is the same used in your `RouteServiceProvider` for the api routes.

### Routing
The packages adds a layer on top of the Laravel routing system allowing you to easily add metadata to your routes
in order to create a [Swagger](https://swagger.io/) compliant API.

We provide an `Api` facade that works with the same syntax as the `Route` facade and that you can use directly in your
`routes/api.php` file.

```php
Api::get('some-uri', 'Controller@action');

Api::post('some-uri', function () {
    // do something
});
```

**Note:** the supported methods: `get`, `post`, `put`, `delete`, `patch`, `options`. There's no support for the `match`
method because every route must associated with a single Operation in the Swagger specification.

When you create a new route through the Api facade returns an instance of an [Operation](https://swagger.io/specification/#tagObject) 
object. This object exposes some chainable configuration methods. The following example shows an extensive use of those
methods.

```php
Api::get('some-uri', 'Controller@action')
    ->setSummary('My operation summary')
    ->setDescription('My operation description')
    ->addTag('some-tag')
    ->setOperationId('executeAction')
    ->setConsumes(['application/json'])
    ->setProduces(['application/json']);
```

#### Operation parameters
WIP


## Advanced configuration

### Tags
In order to create a [tag](https://swagger.io/specification/#tagObject) for your operations, you may call the `tag` 
method passing the name of the tag and its description, if needed.

You can also pass a callback function to create a group of operations automatically tagged with the given tag.

```php
Api::tag('foobar', 'Tag description', function() {
    Api::get('tagged-uri', 'Controller@action');
});
```

You may register many tags at once by passing an array to the `tags` method:

```php
Api::tags(
    [
        'tag_1' => 'Some tag description',
        'tag_2' => 'Some other tag description'
    ]
);
```

### Versions
If you want to group your routes by different version, you may use the `version` method. The grouped routes will be
automatically prefixed and tagged with the given version name.

```php
/**
 * /api/v1/versioned-uri
 */
Api::tag('v1', function() {
    Api::get('tagged-uri', 'Controller@action');
});

/**
 * /api/v2/versioned-uri
 */
Api::tag('v2', function() {
    Api::get('versioned-uri', 'Controller@action');
});
```

### Aggregated resources endpoint
An aggregate endpoint is an API endpoint that returns a mixed collection of resources, combining both Eloquent models 
and data generated by Closures.

> **Note:** closures require a non-numeric array key. See the example below.

```php
Api::aggregate ( 'aggregate/uri', [
    'App\\Page',
    'App\\Post',
    'settings' => function ( SettingStore $settings ) {
        return $settings->all ();
    },
 ] );
```

#### Customize the response
If you use custom [API Resources](https://laravel.com/docs/5.5/eloquent-resources) to personalize the API data you
can define the following methods on the very same model in order the provide the right resource to the API server.

```php
public function toApiResource ( $resource )
{
    return new MyCustomResource ( $resource );
}


public function toApiResourceCollection ( $resource )
{
    return new MyCustomResourceCollection ( $resource );
}
```


## License

[FinneganCDS](https://gitlab.test5.hce.it/finnegan/extensions) and its extensions are open-sourced software licensed 
under the [MIT license](http://opensource.org/licenses/MIT).
